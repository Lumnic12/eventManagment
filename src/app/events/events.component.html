<ion-header>
  <ion-toolbar color="white" >
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Events</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/registered-events">
        My Events
        <ion-badge color="danger" *ngIf="registeredCount > 0">{{registeredCount}}</ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar placeholder="Search events" (ionChange)="searchEvents($event)"></ion-searchbar>
  </ion-toolbar>
  <ion-segment [(ngModel)]="selectedCategory" (ionChange)="filterEvents()">
    <ion-segment-button value="all">
      <ion-label>All</ion-label>
    </ion-segment-button>
    <ion-segment-button value="music">
      <ion-label>Music</ion-label>
    </ion-segment-button>
    <ion-segment-button value="sports">
      <ion-label>Sports</ion-label>
    </ion-segment-button>
    <ion-segment-button value="tech">
      <ion-label>Tech</ion-label>
    </ion-segment-button>
  </ion-segment>
</ion-header>

<ion-content>
  <div *ngIf="selectedEvent" class="event-details">
    <ion-button fill="clear" (click)="closeEventDetails()">
      <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
      Back to Events
    </ion-button>

    <ion-card>
      <img [src]="selectedEvent.image" alt="{{selectedEvent.title}}">
      <ion-card-header>
        <ion-card-subtitle>{{selectedEvent.date}} | {{selectedEvent.location}}</ion-card-subtitle>
        <ion-card-title>{{selectedEvent.title}}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>{{selectedEvent.description}}</p>

        <ion-item lines="none">
          <ion-icon name="calendar-outline" slot="start"></ion-icon>
          <ion-label>{{selectedEvent.date}}</ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="location-outline" slot="start"></ion-icon>
          <ion-label>{{selectedEvent.location}}</ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="pricetag-outline" slot="start"></ion-icon>
          <ion-label>{{selectedEvent.category}}</ion-label>
        </ion-item>

        <div class="registration-actions">
          <ion-button *ngIf="!isRegistered(selectedEvent.id)" expand="block" color="primary"
            (click)="registerForEvent(selectedEvent)">
            Register for Event
          </ion-button>
          <ion-button *ngIf="isRegistered(selectedEvent.id)" expand="block" color="danger"
            (click)="unregisterFromEvent(selectedEvent)">
            Cancel Registration
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <div class="events-list responsive-grid" *ngIf="!selectedEvent">
    <ion-card *ngFor="let event of filteredEvents" (click)="viewEventDetails(event)">
      <div class="event-image-container">
        <img [src]="event.image" alt="{{ event.title }}">
        <div *ngIf="isRegistered(event.id)" class="registered-badge">
          <ion-badge color="success">Registered</ion-badge>
        </div>
      </div>
      <ion-card-header>
        <ion-card-subtitle>{{ event.date }}</ion-card-subtitle>
        <ion-card-title>{{ event.title }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p><ion-icon name="location-outline"></ion-icon> {{ event.location }}</p>
        <p><ion-icon name="pricetag-outline"></ion-icon> {{ event.category }}</p>
        <p>{{ event.description }}</p>
        <ion-button *ngIf="!isRegistered(event.id)" fill="outline" size="small"
          (click)="registerForEvent(event); $event.stopPropagation()">
          Register
        </ion-button>
        <ion-button *ngIf="isRegistered(event.id)" fill="outline" color="danger" size="small"
          (click)="unregisterFromEvent(event); $event.stopPropagation()">
          Unregister
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>


</ion-content>

<ion-toast [isOpen]="isToastOpen" [message]="toastMessage" [duration]="2000" (didDismiss)="isToastOpen = false"
  position="bottom" color="success"></ion-toast>